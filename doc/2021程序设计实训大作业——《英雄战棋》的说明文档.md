# 2021程序设计实训大作业——《英雄战棋》的说明文档

by 2020012401 付家华

## 编译、运行环境

Qt 5.12.11 + Windows 10

## 类的设计

本程序实现的类可分为三种：窗体类、控制类和棋子类。

### 窗体类

窗体类有如下几种，它们都继承自MainWindow, Widget或Dialog类。

1. InitWindow

   继承自MainWindow，是游戏的主菜单，最先展示的界面。

2. GameWindow

   继承自MainWindow，负责游戏的主界面展示。定义了绘图事件、按键事件、鼠标点击事件，负责与用户交互。该类中最核心的函数gameStart以回合制的逻辑控制了双方的战斗。

3. LoseDialog, FirstlyWinDialog, FinallyWinDialog, PauseDialog

   继承自Dialog，分别在失败、第一关通过、第二关通过、暂停时弹出。

4. ReviewWidget

   继承自Widget，战斗复盘窗口。可以在上述对话框中点击按钮调出。

### 控制类

1. WindowController

   存储了所有窗口的指针，关联信号与槽，管理窗口的调用和关闭。

2. GameController

   存储了游戏中的状态量（如双方棋子指针的列表，已经放置的棋子数，复盘日志等）和常量（地图样式，每关可放置的棋子数），并且控制棋子之间的互动。该类只有一个实例，其指针gameController存储在GameWindow对象中。

### 棋子类

棋子类都继承自Chess类，通过虚函数的方式实现不同类的多态性。棋子设计直接使用了《英雄联盟》中的英雄名与头像。

1. Chess

   继承自QObject类，存储棋子属性（如生命值、攻击力、攻击距离、步长，是否存活，位置坐标）。

2. ArcherChess

   射手“皮城女警”。射程远。

3. AssassinChess

   刺客“德玛西亚之翼”，射程较远，机动性强（每回合可以移动两格）。

4. TankChess

   坦克“祖安狂人”，生命值很高，并且会降低20%来自敌方棋子的伤害。

5. BossChess

   Boss“金属大师”，生命值，攻击力很高。

### 其他

index.h定义了结构体Index，定义了5\*5地图上的坐标。

includedLibs.h中包含了一些公用的头文件，方便头文件的包含。

## 游戏流程

### 进入菜单

main函数中WindowController构建，在构造函数中调用了initWindow->show()。菜单界面显示，点击进入游戏。

### 进入游戏

以下各流程在窗口下方状态栏中都有显示。

#### 放置棋子

按右键在地图上放置棋子。mousePressEvent()响应。

#### 回合开始

棋子放置完成后会跳转到GameWindow::gameStart()函数。回合中我方（蓝色方）的每一枚棋子都可以先移动后攻击，然后轮到敌方（红色方，由AI操控）操作。

按WASD选择移动方向，P选择不移动，左键攻击，右键点击已有棋子可以查看详细信息，Esc暂停。

#### 关卡跳转

第一关完成后跳出对话框，可以选择进入第二关。GameWindow::restart(int)负责重置gameController和重绘。完成后重复前两步。

### 胜利、失败

一方棋子被全歼判定为失败。可以通过信号槽机制调出对话框。

## 功能与演示

以下各部分对应作业功能要求的文档。

### 界面、交互设计

要求全部完成。

游戏窗口中下方的状态栏和上方的信息栏给出了玩法说明，可以直接打开程序体验。

为了快速过关，可以在各棋子类的构造函数中把敌方棋子的初始生命值降低。（带有bool参数的构造函数用于构造敌方棋子）

### 地形设计

设计了四种地形：

- 普通地形：绿色，可以放置棋子和自由移动
- 妨碍地形：黄色，如果棋子移动到这里，本回合将不能攻击
- 阻挡地形：黑色，无法通过
- 损伤地形：红色，可以放置棋子和自由移动，但是每在这里停一回合会扣除50点生命值

### 敌我方角色设计

设计了射手、坦克、刺客和Boss型角色，详细可以看本文档第一部分中棋子类的说明。

### 战斗设计

完成了回合制（蓝色方行动全部完成后轮到红色方）、移动范围可视化（看方格地图的颜色就行）和伤害结算。

攻击范围没有可视化展示，但可以右键点击英雄查看详细信息。数字1代表1格，方格间的距离为Euclid距离，当选中了攻击范围以外的目标时也会在状态栏中提示。

### 关卡设计

设计了2关，一方被全歼即判定为失败。

### 敌方AI设计

敌方AI的行动原则为：如果攻击范围内存在敌人则不移动，否则向着最近的敌人靠近。

### 其他要求

添加了背景音乐和打击音效。

图片素材均为《英雄联盟》的英雄原画。

实现了战斗复盘功能，调出暂停、胜利、失败对话框后可以按按钮可以调出。

但是很遗憾，我没能实现动画效果。地图以及棋子头像都是在gameWindow上直接调用QPainter::drawPixmap()画成，没有把pixmap覆盖在一些组件上。而QPropertyAnimation类不能直接作用于QPixmap。

## 参考

[等待/延时的写法](https://blog.csdn.net/xu1129005165/article/details/82490763)

